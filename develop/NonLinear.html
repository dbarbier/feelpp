<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.1.2"/>
<title>Feel++: Non Linear Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="feel.css"   rel="stylesheet" type="text/css" />
<link href="feel.css" rel="stylesheet" type="text/css">
<!-- $extrastylesheet -->
<script type="text/javascript" src="eigen_navtree_hacks.js"></script>
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
    <div id="projectname"><a href="http://www.feelpp.org/"><img alt="Logo" src="feel_logo_small.png"/></a>
   &#160;<span id="projectnumber">0.94.0</span>
   </div>
   <div id="projectbrief">Finite Element Embedded Library and Language in C++</div>
  </td>
  <td width="500px" align="center" valign="bottom">
    <a href="http://www.feelpp.org/"><img alt="Feel++" src="home.png"/></a>
    <a href="https://github.com/feelpp/feelpp"><img alt="Feel++ on Github" src="http://sciactive.github.io/pnotify/includes/github-icon.png"/></a>
    <a href="https://plus.google.com/communities/104696212880173187475"><img alt="Feel++ community" src="google.png"/></a>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('NonLinear.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Non Linear Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Solving">Solving Nonlinear Equations</a><ul><li class="level2"><a href="#Solving_First">A first nonlinear problem</a></li>
<li class="level2"><a href="#Solving_Simplified">Simplified combustion problem: Bratu</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Christophe Prud'homme</dd></dl>
<p><br/>
 <hr/>
 <br/>
</p>
<h1><a class="anchor" id="Solving"></a>
Solving Nonlinear Equations</h1>
<p><a href="http://www.feelpp.org">Feel++</a> allows to solve nonlinear equations thanks to its interface to the interface to the PETSc nonlinear solver library. It requires the implementation of two extra functions in your application that will update the jacobian matrix associated to the tangent problem and the residual.</p>
<p>Consider that you have an application class <code>MyApp</code> with a backend as data member </p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;feel/feelcore/feel.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="application_8hpp.html">feel/feelcore/application.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="backend_8hpp.html">feel/feelalg/backend.hpp</a>&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>Feel {</div>
<div class="line">                                    </div>
<div class="line"><span class="keyword">class </span>MyApp : <span class="keyword">public</span> Application</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">                                  </div>
<div class="line">  <span class="keyword">typedef</span> Backend&lt;double&gt; backend_type;</div>
<div class="line">  <span class="keyword">typedef</span> boost::shared_ptr&lt;backend_type&gt; backend_ptrtype;</div>
<div class="line">                                  </div>
<div class="line">  MyApp( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv,</div>
<div class="line">  AboutData <span class="keyword">const</span>&amp; ad, po::options_description <span class="keyword">const</span>&amp; od )</div>
<div class="line">  :</div>
<div class="line">  <span class="comment">// init the parent class</span></div>
<div class="line">  Application( argc, argv, ad, od ),</div>
<div class="line">  <span class="comment">// init the backend</span></div>
<div class="line">  M_backend( backend_type::build( this-&gt;vm() ) ),</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// define the callback functions (works only for the PETSc backend)</span></div>
<div class="line">    M_backend-&gt;nlSolver()-&gt;residual =</div>
<div class="line">      boost::bind( &amp;self_type::updateResidual, boost::ref( *<span class="keyword">this</span> ), _1, _2 );</div>
<div class="line">    M_backend-&gt;nlSolver()-&gt;jacobian =</div>
<div class="line">      boost::bind( &amp;self_type::updateJacobian, boost::ref( *<span class="keyword">this</span> ), _1, _2 );</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> updateResidual( <span class="keyword">const</span> vector_ptrtype&amp; X, vector_ptrtype&amp; R )</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// update the matrix J (Jacobian matrix) associated</span></div>
<div class="line">    <span class="comment">// with the tangent problem</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> updateJacobian( <span class="keyword">const</span> vector_ptrtype&amp; X, sparse_matrix_ptrtype&amp; J)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// update the vector R associated with the residual</span></div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> run()</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">//define space</span></div>
<div class="line">    Xh...</div>
<div class="line">    element_type u(Xh);</div>
<div class="line">    <span class="comment">// initial guess is 0</span></div>
<div class="line">    u = <a class="code" href="namespaceFeel.html#ae89776231eca6bd68ba734da512759b3">project</a>( M_Xh, <a class="code" href="namespaceFeel.html#a39073cc1999197bf9963bd5bdc86454a">elements</a>(mesh), constant(0.) );</div>
<div class="line">    vector_ptrtype U( M_backend-&gt;newVector( u.functionSpace() ) );</div>
<div class="line">    *U = u;</div>
<div class="line">                                  </div>
<div class="line">    <span class="comment">// define R and J</span></div>
<div class="line">    vector_ptrtype R( M_backend-&gt;newVector( u.functionSpace() ) );</div>
<div class="line">    sparse_matrix_ptrtype J;</div>
<div class="line">                                  </div>
<div class="line">    <span class="comment">// update R</span></div>
<div class="line">    updateJacobian( U, R );</div>
<div class="line">    <span class="comment">// update J</span></div>
<div class="line">    updateResidual( U, J );</div>
<div class="line">                                  </div>
<div class="line">    <span class="comment">// solve using non linear methods (newton)</span></div>
<div class="line">    <span class="comment">// tolerance : 1e-10</span></div>
<div class="line">    <span class="comment">// max number of iterations : 10</span></div>
<div class="line">    M_backend-&gt;nlSolve( J, U, R, 1e-10, 10 );</div>
<div class="line">                                  </div>
<div class="line">    <span class="comment">// the soluution was stored in U</span></div>
<div class="line">    u = *U;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">                                  </div>
<div class="line">  backend_ptrtype M_backend;</div>
<div class="line">};</div>
<div class="line">} <span class="comment">// namespace Feel</span></div>
</div><!-- fragment --><p>The function <code>updateJacobian</code> and <code>updateResidual</code> implement the assmebly of the matrix <img class="formulaInl" alt="$J$" src="form_714.png"/> (jacobian matrix) and the vector <img class="formulaInl" alt="$R$" src="form_852.png"/> (residual vector) respectively.</p>
<h2><a class="anchor" id="Solving_First"></a>
A first nonlinear problem</h2>
<p>As a simple example, let <img class="formulaInl" alt="$\Omega $" src="form_853.png"/> be a subset of <img class="formulaInl" alt="$\mathbb{R}^d, d=1,2,3$" src="form_854.png"/>, (<em>i.e</em>. <img class="formulaInl" alt="$\Omega=[-1,1]^d$" src="form_855.png"/>) with boundary <img class="formulaInl" alt="$\partial \Omega$" src="form_411.png"/>. Consider now the following equation and boundary condition <br/>
</p>
<center> <img class="formulaInl" alt="$ \begin{aligned} -\Delta u + u^\lambda = f,\quad u = 0 \text{ on } \partial \Omega. \end{aligned} $" src="form_856.png"/></center><p><br/>
</p>
<p>where <img class="formulaInl" alt="$\lambda \in \mathbb{R_+}$" src="form_857.png"/> is a given parameter and <img class="formulaInl" alt="$f=1$" src="form_433.png"/>.</p>
<dl class="section note"><dt>Note</dt><dd>To be described in this section. For now see <code>"doc/manual/nonlinear/nonlinearpow.cpp"</code> for an implementation of this problem.</dd></dl>
<h2><a class="anchor" id="Solving_Simplified"></a>
Simplified combustion problem: Bratu</h2>
<p>As a simple example, let <img class="formulaInl" alt="$\Omega$" src="form_210.png"/> be a subset of <img class="formulaInl" alt="$\mathbb{R}^d, d=1,2,3$" src="form_854.png"/>,(<em>i.e</em>. <img class="formulaInl" alt="$\Omega=[-1,1]^d$" src="form_855.png"/>) with boundary <img class="formulaInl" alt="$\partial\Omega$" src="form_284.png"/>. Consider now the following equation and boundary condition <br/>
</p>
<center> <img class="formulaInl" alt="$ \begin{aligned} -\Delta u + \lambda e^u = f,\quad u = 0 \text{ on } \partial \Omega \end{aligned} $" src="form_858.png"/></center><p><br/>
</p>
<p>where <img class="formulaInl" alt="$\lambda$" src="form_286.png"/> is a given parameter. This is usually called the Bratu problem and appears in the simplification of nonlinear diffusion process for example in the field of combustion.</p>
<dl class="section note"><dt>Note</dt><dd>To be described in this section. For now see <code>"doc/manual/nonlinear/bratu.cpp"</code> for an implementation of this problem. </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr size="1"><address style="text-align: right;"><small>
Generated on Thu Jul 25 2013 00:08:26 for Feel++ by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.1.2</small></address>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40726726-1', 'github.io');
  ga('send', 'pageview');
</script>
</body>
</html>
