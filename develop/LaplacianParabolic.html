<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Feel++: Parabolic equation example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="feel.css"   rel="stylesheet" type="text/css" />
<link href="feel.css" rel="stylesheet" type="text/css">
<!--  -->
<script type="text/javascript" src="eigen_navtree_hacks.js"></script>
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
    <div id="projectname"><a href="http://www.feelpp.org/"><img alt="Logo" src="feel_logo_small.png"/></a>
   &#160;<span id="projectnumber">0.96.0-alpha.1+git26dc228</span>
   </div>
   <div id="projectbrief">Finite Element Embedded Library and Language in C++</div>
  </td>
  <td width="500px" align="center" valign="bottom">
    <a href="http://www.feelpp.org/"><img alt="Feel++" src="home.png"/></a>
    <a href="https://github.com/feelpp/feelpp"><img alt="Feel++ on Github" src="http://sciactive.github.io/pnotify/includes/github-icon.png"/></a>
    <a href="https://plus.google.com/communities/104696212880173187475"><img alt="Feel++ community" src="google.png"/></a>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('LaplacianParabolic.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Parabolic equation example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Description">Description</a><ul><li class="level2"><a href="#Discretization">Time Discretization</a></li>
</ul>
</li>
<li class="level1"><a href="#Implementation">Implementation</a><ul><li class="level2"><a href="#BDF">BDF set up</a></li>
<li class="level2"><a href="#Error">Error class</a></li>
</ul>
</li>
<li class="level1"><a href="#Results">Results</a><ul><li class="level2"><a href="#Stationnary">Stationnary study</a></li>
<li class="level2"><a href="#Temporal">Temporal study</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Christophe Prud'homme <a href="#" onclick="location.href='mai'+'lto:'+'chr'+'is'+'top'+'he'+'.pr'+'ud'+'hom'+'me'+'@fe'+'el'+'pp.'+'or'+'g'; return false;">chris<span style="display: none;">.nosp@m.</span>toph<span style="display: none;">.nosp@m.</span>e.pru<span style="display: none;">.nosp@m.</span>dhom<span style="display: none;">.nosp@m.</span>me@fe<span style="display: none;">.nosp@m.</span>elpp<span style="display: none;">.nosp@m.</span>.org</a> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2013-06-19</dd></dl>
<h1><a class="anchor" id="Description"></a>
Description</h1>
<p>This section is about another example easy to learn and understand : the parabolic equation. The aim is to solve equations like : </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \left\{ \begin{aligned} \dfrac{\partial u}{\partial t} - nu*\Delta u = f &amp; \text{on}\; \Omega \;, \ u &amp; = 0 &amp; \text{on}\;\partial\Omega \;,\ \end{aligned} \right. \end{equation}" src="form_434.png"/>
</p>
<p>where <img class="formulaInl" alt="$u\in\Omega$" src="form_422.png"/> is the unknown "trial" function and <img class="formulaInl" alt="$\Omega$" src="form_210.png"/> the domain.</p>
<p>However this LaplacianParabolic application can also be used in the stationnary form, that is to say, solve the equation : </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \left\{ \begin{aligned} - nu*\Delta u = f &amp; \text{on}\; \Omega \;, \ u &amp; = 0 &amp; \text{on}\;\partial\Omega \;,\ \end{aligned} \right. \end{equation}" src="form_435.png"/>
</p>
<h2><a class="anchor" id="Discretization"></a>
Time Discretization</h2>
<h1><a class="anchor" id="Implementation"></a>
Implementation</h1>
<p>The overall code is based on the <a class="el" href="laplacian_8cpp.html">laplacian.cpp</a> application to which we added time discretization and other useful options. The time derivative will be discretized following a backward method called {Backward Differentiation Formula}; it is a finite differences method, used a lot in time discretization. Here, we don't go deeply in the implementation of BDF; a how-to about it can be get in Feel++ pdf tutorial.</p>
<h2><a class="anchor" id="BDF"></a>
BDF set up</h2>
<p>The instationnary solving of this equation is not far different from solving the laplacian equation : in fact the laplacian equation is solved at each time iteration (called time-step). First we instantiate BDF objects : </p>
<div class="fragment"><div class="line">  <span class="comment">// create the BDF structure</span></div>
<div class="line">  bdf_ptrtype M_bdf = bdf( _space=Xh, _name=<span class="stringliteral">&quot;u&quot;</span> );</div>
<div class="line"></div>
<div class="line">  <span class="comment">// start the time at time-initial</span></div>
<div class="line">  M_bdf-&gt;start();</div>
<div class="line">  <span class="comment">// create the finite difference polynome of the unknown</span></div>
<div class="line">  M_bdf-&gt;initialize(u);</div>
</div><!-- fragment --><p> Then we put a <code>do</code>..while loop for the time iteration : </p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span>{</div>
<div class="line">    <span class="comment">//set the linear form</span></div>
<div class="line">    form1=...</div>
<div class="line"></div>
<div class="line">    <span class="comment">//set the bilinear form</span></div>
<div class="line">    form2=...</div>
<div class="line"></div>
<div class="line"><span class="comment">//solve</span></div>
<div class="line">backend(_rebuild=<span class="keyword">true</span>)-&gt;solve(...);</div>
<div class="line">}<span class="keywordflow">while</span>( M-bdf-&gt;isFinished() == false );</div>
</div><!-- fragment --><p>The time derivative discretization is done in black box; we simply wrote : </p>
<div class="fragment"><div class="line">  <span class="keywordflow">if</span>( !steady )</div>
<div class="line">    a += <a class="code" href="namespaceFeel.html#a4c300b4c137594540a9428af36363049" title="integrate a polynomial over a convex ">integrate</a>( _range=<a class="code" href="namespaceFeel.html#ace44a7a9c428a5849b81de59532e4ef8">elements</a>( mesh ), _expr = cst(M_bdf-&gt;polyDerivCoefficient( 0 ))*idt(u)*id(v) );</div>
</div><!-- fragment --><p> for the bilinear form, and : </p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span>( !steady )</div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">auto</span> bdf_poly = M_bdf-&gt;polyDeriv();</div>
<div class="line">      l += <a class="code" href="namespaceFeel.html#a4c300b4c137594540a9428af36363049" title="integrate a polynomial over a convex ">integrate</a>( _range = <a class="code" href="namespaceFeel.html#ace44a7a9c428a5849b81de59532e4ef8">elements</a>(mesh), _expr = idv( bdf_poly )*<span class="keywordtype">id</span>(v));</div>
<div class="line">    }</div>
</div><!-- fragment --><p> for the linear form. In steady mode, those terms will not be added.</p>
<p>At the begining, one should have put all terms inside the time loop. But here, in our case, there are terms which are not time depending ones; so it is useless to have them inside the time loop and performing useless computations. The application will compute once and for all before the begining of the time loop and will add them to the temporal terms : </p>
<div class="fragment"><div class="line"></div>
<div class="line">  <span class="keyword">auto</span> D = backend()-&gt;newMatrix( _test=Xh, _trial=Xh  );</div>
<div class="line"></div>
<div class="line">  <span class="keyword">auto</span> a = form2( _test=Xh, _trial=Xh, _matrix=D );</div>
<div class="line">  a = <a class="code" href="namespaceFeel.html#a4c300b4c137594540a9428af36363049" title="integrate a polynomial over a convex ">integrate</a>( _range=<a class="code" href="namespaceFeel.html#ace44a7a9c428a5849b81de59532e4ef8">elements</a>( mesh ), _expr=nu*gradt( u )*trans( grad( v ) ) );</div>
</div><!-- fragment --> <div class="fragment"><div class="line">    a += <a class="code" href="namespaceFeel.html#a4c300b4c137594540a9428af36363049" title="integrate a polynomial over a convex ">integrate</a>( _range=<a class="code" href="namespaceFeel.html#ac0d40e0852d5f0d447623caff773b1a5">markedfaces</a>( mesh,<span class="stringliteral">&quot;Dirichlet&quot;</span> ),</div>
<div class="line">        _expr= nu * ( -( gradt( u )*vf::N() )*<span class="keywordtype">id</span>( v )</div>
<div class="line">          -( grad( v )*vf::N() )*idt( u )</div>
<div class="line">          +penaldir*<span class="keywordtype">id</span>( v )*idt( u )/hFace() ) );</div>
</div><!-- fragment --> <dl class="section warning"><dt>Warning</dt><dd>At the end of each solve, we should re-initialised $u^{n}$, $u^{n-1}$...; so don't forget the shifting operation : <div class="fragment"><div class="line">    M_bdf-&gt;shiftRight(u);</div>
</div><!-- fragment --> and also, don't forget to increment the time : <div class="fragment"><div class="line">    M_bdf-&gt;next();</div>
</div><!-- fragment --> </dd></dl>
<h2><a class="anchor" id="Error"></a>
Error class</h2>
<p>The Error class allows users to define a test solution that has to be found by the application, to compute the Right Hand Side term of the equation and to compute L2 and H1 errors.</p>
<p>First we set the exact solution (if it is given in the <code></code>.cfg file) and the associated parameter(s) : </p>
<div class="fragment"><div class="line">    <span class="keywordflow">if</span> ( !params.empty() )</div>
<div class="line">      cvg-&gt;setParams ( params );</div>
</div><!-- fragment --> <div class="fragment"><div class="line">    cvg-&gt;setSolution(exact, params);</div>
</div><!-- fragment --><p> Then compute the rhs according to the equation : </p>
<div class="fragment"><div class="line">  <span class="comment">// if rhs should be computed</span></div>
<div class="line">  <span class="keywordflow">if</span>(cvg-&gt;computedrhs())</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// if it is not defined</span></div>
<div class="line">    <span class="keywordflow">if</span>( rhs.empty() )</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// compute it from the exact function</span></div>
<div class="line">      FEELPP_ASSERT( exact.size() ).error( <span class="stringliteral">&quot;no exact function defined, no rhs function defined. Aborting...&quot;</span>);</div>
<div class="line"></div>
<div class="line">      <span class="comment">// with the edp of the parabolic equation</span></div>
<div class="line">      <span class="keywordflow">if</span> ( !steady )</div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::function&lt;ex (ex u, std::vector&lt;symbol&gt; vars, std::vector&lt;symbol&gt; p)&gt; t_edp_type;</div>
<div class="line">        t_edp_type t_edp = <a class="code" href="structtransient__edp.html" title="Defines the edp to be solved in the instationnary case : . ">transient_edp</a>();</div>
<div class="line">        cvg-&gt;setRhs(&amp;t_edp);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// or with the normal laplacian equation</span></div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        <span class="keyword">typedef</span> <span class="keyword">typename</span> boost::function&lt;ex (ex u, std::vector&lt;symbol&gt; vars)&gt; edp_type;</div>
<div class="line">        edp_type edp =  <a class="code" href="structsteady__edp.html" title="Defines the edp to be solved in the stationnary case : . ">steady_edp</a>();</div>
<div class="line">        cvg-&gt;setRhs(&amp;edp);</div>
<div class="line">      }</div>
<div class="line">      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;computed rhs is : &quot;</span> &lt;&lt; cvg-&gt;getRhs() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// else it is defined, so ok</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      cvg-&gt;setRhs();</div>
<div class="line">      LOG(INFO) &lt;&lt; <span class="stringliteral">&quot;rhs is : &quot;</span> &lt;&lt; cvg-&gt;getRhs() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;rhs is : &quot;</span> &lt;&lt; cvg-&gt;getRhs() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Eventually, compute the L2 and H1 error : </p>
<div class="fragment"><div class="line">      <span class="keywordtype">double</span> L2error = normL2( _range=<a class="code" href="namespaceFeel.html#ace44a7a9c428a5849b81de59532e4ef8">elements</a>( mesh ),_expr=( idv( u )-idv(gproj) ) );</div>
<div class="line">      <span class="keywordtype">double</span> H1seminorm = math::sqrt( <a class="code" href="namespaceFeel.html#a4c300b4c137594540a9428af36363049" title="integrate a polynomial over a convex ">integrate</a>( <a class="code" href="namespaceFeel.html#ace44a7a9c428a5849b81de59532e4ef8">elements</a>(mesh), (gradv(u) - gradg)*trans(gradv(u) - gradg) ).evaluate()(0,0) );</div>
<div class="line">      <span class="keywordtype">double</span> H1error = math::sqrt( L2error*L2error + H1seminorm*H1seminorm);</div>
</div><!-- fragment --> <dl class="section warning"><dt>Warning</dt><dd>Be careful, do NOT use the L2 and H1 error computation of the Error class, because they are written in cylindrical coordinates !</dd></dl>
<h1><a class="anchor" id="Results"></a>
Results</h1>
<p>To verify and validate the implementation, we made convergence study in stationnary and in temporal modes. The exact solution in the input is : </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \sin(\Pi(x-1)) \sin(\Pi\dfrac{y-0.05}{0.1})e^{-t} \end{equation}" src="form_436.png"/>
</p>
<p> (in the border, it is indeed equal to 0).</p>
<p>For the time error, we implemented this formula :</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} E_{r} = \left( \Delta t \: \sum\limits_{t=t_i}^{t_f} \| u - u^n \|_{L^2(\Omega^{tn})}^2 \right)^{\frac{1}{2}} \end{equation}" src="form_437.png"/>
</p>
<p>Here we go with the graphs : </p>
<h2><a class="anchor" id="Stationnary"></a>
Stationnary study</h2>
<p>We have a very good convergence slope in P1. We should also get a good convergence in P2 and further.</p>
<div class="image">
<img src="Laplacian_parabolic_L2_error.png" alt="Laplacian_parabolic_L2_error.png"/>
</div>
 <div class="image">
<img src="Laplacian_parabolic_H1_error.png" alt="Laplacian_parabolic_H1_error.png"/>
</div>
<h2><a class="anchor" id="Temporal"></a>
Temporal study</h2>
<p>Here is something very interesting : depending the problem (the exact solution, the rhs, boundary conditions etc...), the theorical slope is not reached for "big" time-steps, but only when they are decreasing (BDF1, BDF2, BDF3); then, if the slope begins to behave wrongly, try to increase the precision of the geometry (BDF2 and BDF3). </p>
<div class="image">
<img src="Laplacian_parabolic_BDF1.png" alt="Laplacian_parabolic_BDF1.png"/>
</div>
 <div class="image">
<img src="Laplacian_parabolic_BDF2.png" alt="Laplacian_parabolic_BDF2.png"/>
</div>
 <div class="image">
<img src="Laplacian_parabolic_BDF3.png" alt="Laplacian_parabolic_BDF3.png"/>
</div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<hr size="1"><address style="text-align: right;"><small>
Generated on Thu Oct 31 2013 00:01:58 for Feel++ by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.4</small></address>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40726726-1', 'github.io');
  ga('send', 'pageview');
</script>
</body>
</html>
