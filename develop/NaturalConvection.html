<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.1.2"/>
<title>Feel++: Natural Convection in a heated Tank</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="feel.css"   rel="stylesheet" type="text/css" />
<link href="feel.css" rel="stylesheet" type="text/css">
<!-- $extrastylesheet -->
<script type="text/javascript" src="eigen_navtree_hacks.js"></script>
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
    <div id="projectname"><a href="http://www.feelpp.org/"><img alt="Logo" src="feel_logo_small.png"/></a>
   &#160;<span id="projectnumber">0.93.0</span>
   </div>
   <div id="projectbrief">Finite Element Embedded Library and Language in C++</div>
  </td>
  <td width="500px" align="center" valign="bottom">
    <a href="http://www.feelpp.org/"><img alt="Feel++" src="home.png"/></a>
    <a href="https://github.com/feelpp/feelpp"><img alt="Feel++ on Github" src="http://sciactive.github.io/pnotify/includes/github-icon.png"/></a>
    <a href="https://plus.google.com/communities/104696212880173187475"><img alt="Feel++ community" src="google.png"/></a>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('NaturalConvection.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Natural <a class="el" href="classConvection.html">Convection</a> in a heated Tank </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Description">Description</a></li>
<li class="level1"><a href="#Influence">Influence of parameters</a></li>
<li class="level1"><a href="#Quantities">Quantities of interest</a><ul><li class="level2"><a href="#Quantities_Mean">Mean temperature</a></li>
<li class="level2"><a href="#Quantities_Flow">Flow rate</a></li>
</ul>
</li>
<li class="level1"><a href="#Numerical">Numerical Schemes</a><ul><li class="level2"><a href="#Numerical_Stokes">The Stokes problem</a></li>
<li class="level2"><a href="#Numerical_Reformulation">Reformulation</a></li>
<li class="level2"><a href="#Numerical_Variational">Variational formulation</a></li>
<li class="level2"><a href="#Numercial_Implementation">Implementation</a></li>
<li class="level2"><a href="#Numerical_Fic">Fix point iteration for Navier-Stokes</a><ul><li class="level3"><a href="#Fix_Steady">Steady incompressible Navier-Stokes equations</a></li>
</ul>
</li>
<li class="level2"><a href="#Nuerical_Coupling">A Fix point coupling algorithm</a><ul><li class="level3"><a href="#Coupling_Problem">Coupling fluid flow and heat transfer: problem</a></li>
<li class="level3"><a href="#Coupling_Algorithm">Coupling fluid flow and heat transfer: algorithm</a></li>
</ul>
</li>
<li class="level2"><a href="#Numerical_Newton">A Newton coupling algorithm</a><ul><li class="level3"><a href="#Newton_Scheme">A fully coupled scheme</a></li>
<li class="level3"><a href="#Newton_Jacobian">Jacobian matrix</a></li>
<li class="level3"><a href="#Newton_Implementation">Implementation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Christophe Prud'homme</dd></dl>
<p><br/>
 <hr/>
 <br/>
</p>
<h1><a class="anchor" id="Description"></a>
Description</h1>
<p>The goal of this project is to simulate the fluid flow under natural convection: the heated fluid circulates towards the low temperature under the action of density and gravity differences. Thie phenomenon is important in the sense it models evacuation of heat, generated by friction forces for example, with a cooling fluid.</p>
<p>We shall put in place a simple convection problem in order to study the phenomenon without having to handle the difficulties of more complex domaines. We describe then some necessary transformations to the equations, then we define quantities of interest to be able to compare the simulations with different parameter values.</p>
<p>To study the convection, we use a model problem: it consists in a rectangular tank of height <img class="formulaInl" alt="$1$" src="form_511.png"/> and width <img class="formulaInl" alt="$W$" src="form_747.png"/>, in which the fluid is enclosed : </p>
<center> <table  border="0px">
<tr>
<td><div class="image">
<img src="convection_geo.png" alt="convection_geo.png"/>
</div>
  </td></tr>
<tr>
<td><center>Geometry of the model</center>  </td></tr>
</table>
</center><p> We wish to know the fluid velocity <img class="formulaInl" alt="$\mathbf{u}$" src="form_748.png"/>, the fluid pressure <img class="formulaInl" alt="$p$" src="form_282.png"/> and fluid temperature <img class="formulaInl" alt="$\theta$" src="form_749.png"/>.</p>
<p>We introduce the adimensionalized Navier-Stokes and heat equations parametrized by the Grashof and Prandtl numbers. These parameters allow to describe the various regimes of the fluid flow and heat transfer in the tank when varying them.</p>
<p>The adimensionalized steady incompressible Navier-Stokes equations reads: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \begin{split} \mathbf{u}\cdot\nabla \mathbf{u} +\nabla p -\frac{1}{\sqrt{\Gr}} \Delta \mathbf{u} &amp;= \theta \mathbf{e}_2\\ \nabla \cdot \mathbf{u} &amp; = 0\ \text{sur}\ \Omega\\ \mathbf{u} &amp; = \mathbf{0}\ \text{sur}\ \partial \Omega \end{split} \end{equation*}" src="form_750.png"/>
</p>
<p> where <img class="formulaInl" alt="$\Gr$" src="form_751.png"/> is the Grashof number, <img class="formulaInl" alt="$\mathbf{u}$" src="form_748.png"/> the adimensionalized velocity and <img class="formulaInl" alt="$p$" src="form_282.png"/> adimensionalized pressure and <img class="formulaInl" alt="$\theta$" src="form_749.png"/> the adimensionalized temperature. The temperature is in fact the difference between the temperature in the tank and the temperature <img class="formulaInl" alt="$T_0$" src="form_752.png"/> on boundary <img class="formulaInl" alt="$\Gamma_1$" src="form_402.png"/>.</p>
<p>The heat equation reads: </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \begin{split} \mathbf{u} \cdot \nabla \theta -\frac{1}{\sqrt{\Gr}\Pr} \Delta \theta &amp;= 0\\ \theta &amp;= 0\ \text{sur}\ \Gamma_1\\ \frac{\partial \theta}{\partial n} &amp;= 0\ \text{sur}\ \Gamma_{2,4}\\ \frac{\partial \theta}{\partial n} &amp;= 1\ \text{sur}\ \Gamma_3 \end{split} \end{equation*}" src="form_753.png"/>
</p>
<p> where <img class="formulaInl" alt="$\Pr$" src="form_754.png"/> is the Prandtl number.</p>
<h1><a class="anchor" id="Influence"></a>
Influence of parameters</h1>
<p>What are the effects of the Grashof and Prandtl numbers ? We remark that both terms with these parameters appear in front of the <img class="formulaInl" alt="$\Delta$" src="form_755.png"/> parameter, they thus act on the diffusive terms. If we increase the Grashof number or the Prandtl number the coefficients multiplying the diffusive terms decrease, and this the convection, that is to say the transport of the heat via the fluid, becomes dominant. This leads also to a more difficult and complex flows to simulate. The influence of the Grashof and Prandtl numbers are different but they generate similar difficulties and flow configurations. Thus we look only here at the influence of the Grashof number which shall vary in <img class="formulaInl" alt="$[1, 1e7]$" src="form_756.png"/>. </p>
<center> <table  border="0px">
<tr>
<td><div class="image">
<img src="flow_grashof.png" alt="flow_grashof.png"/>
</div>
  </td></tr>
<tr>
<td><center>Velocity norm with respect to Grashof, <img class="formulaInl" alt="$ Gr=100, 10000, 100000, 500000$" src="form_757.png"/>.<br/>
 <img class="formulaInl" alt="$h=0.01$" src="form_758.png"/> and <img class="formulaInl" alt="$\Pr=1$" src="form_759.png"/>.</center>  </td></tr>
</table>
</center><h1><a class="anchor" id="Quantities"></a>
Quantities of interest</h1>
<p>We would like to compare the results of many simulations with respect to the Grashof defined in the previous section. We introduce two quantities which will allow us to observe the behavior of the flow and heat transfer.</p>
<h2><a class="anchor" id="Quantities_Mean"></a>
Mean temperature</h2>
<p>We consider first the mean temperature on boundary <img class="formulaInl" alt="$\Gamma_3$" src="form_378.png"/> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} T_3 = \int_{\Gamma_3} \theta \end{equation*}" src="form_760.png"/>
</p>
<p>This quantity should decrease with increasing Grashof because the fluid flows faster and will transport more heat which will cool down the heated boundary <img class="formulaInl" alt="$\Gamma_3$" src="form_378.png"/>. We observe this behavior on this figure. </p>
<center> <table  border="0px">
<tr>
<td><div class="image">
<img src="temp_grashof.png" alt="temp_grashof.png"/>
</div>
  </td></tr>
<tr>
<td><center>Mean temperature with respect to the Grashof number;<br/>
 <img class="formulaInl" alt="$h=0.02$" src="form_761.png"/> with <img class="formulaInl" alt="$\mathbb{P}_3$" src="form_762.png"/> Lagrange element for the velocity, <img class="formulaInl" alt="$\mathbb{P}_2$" src="form_763.png"/> Lagrange for the pressure and <img class="formulaInl" alt="$\mathbb{P}_1$" src="form_764.png"/> Lagrange for the temperature.</center>  </td></tr>
</table>
</center><h2><a class="anchor" id="Quantities_Flow"></a>
Flow rate</h2>
<p>Another quantity of interest is the flow rate through the middle of the tank. We define a segment <img class="formulaInl" alt="$\Gamma_f$" src="form_765.png"/> as being the vertical top semi-segment located at <img class="formulaInl" alt="$W/2$" src="form_766.png"/> with height <img class="formulaInl" alt="$1/2$" src="form_767.png"/>. The flow rate, denoted <img class="formulaInl" alt="$\mathrm{D}_f$" src="form_768.png"/>, reads </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \mathrm{D}_f = \int_{\Gamma_f} \mathbf{u} \cdot \mathbf{e}_1 \end{equation*}" src="form_769.png"/>
</p>
<p> where <img class="formulaInl" alt="$\mathbf{e}_1=(1,0)$" src="form_770.png"/>. Note that the flow rate can be negative or positive depending on the direction in which the fluid flows.</p>
<p>As a function of the Grashof, we shall see a increase in the flow rate. This is true for small Grashof, but starting at <img class="formulaInl" alt="$1e3$" src="form_771.png"/> the flow rate decreases. The fluid is contained in a boundary layer which is becoming smaller as the Grashof increases. </p>
<center> <table  border="0px">
<tr>
<td><div class="image">
<img src="debit_grashof.png" alt="debit_grashof.png"/>
</div>
  </td></tr>
<tr>
<td><center>Behavior of the flow rate with respect to the Grashof number; <br/>
 <img class="formulaInl" alt="$h = 0.02$" src="form_772.png"/>, <img class="formulaInl" alt="$\mathbb{P}_3$" src="form_762.png"/> for the velocity, <img class="formulaInl" alt="$\mathbb{P}_2$" src="form_763.png"/> for the pressure and <img class="formulaInl" alt="$\mathbb{P}_1$" src="form_764.png"/> for the temperature.</center>  </td></tr>
</table>
</center><p>section Implementation Implementation This application in implemented in <code>"feel/doc/manual/heatns/convection.cpp"</code>. The implementation solve the full nonlinear problem using the nonlinear solver framework.</p>
<h1><a class="anchor" id="Numerical"></a>
Numerical Schemes</h1>
<h2><a class="anchor" id="Numerical_Stokes"></a>
The Stokes problem</h2>
<p>Consider the following problem, </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \mbox{Stokes: }\left\{ \begin{array}{rcc} -\mu\Delta\mathbf{u} + \nabla p = \mathbf{f}\\ \nabla\cdot\mathbf{u} = 0\\ \mathbf{u}|_{\partial \Omega} = 0 \end{array} \right. \end{equation*}" src="form_773.png"/>
</p>
<p> where <img class="formulaInl" alt="$\Omega \subset \mathbb{R}^d$" src="form_774.png"/>. There are no boundary condition on the pressure. This problem is ill-posed, indeed we only control the pressure through its gradient <img class="formulaInl" alt="$\nabla p$" src="form_775.png"/>. Thus if <img class="formulaInl" alt="$(\mathbf{u},p)$" src="form_776.png"/> is a solution, then <img class="formulaInl" alt="$(\mathbf{u},p+c)$" src="form_777.png"/> is also a solution with <img class="formulaInl" alt="$c$" src="form_651.png"/> any constant. This comes from the way the problem is posed: the box is closed and it is not possible to determine the pressure inside. The remedy is to impose arbitrarily a constraint on the pressure, e.g. its mean value is zero. In other words, we add this new equation to the problem </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \int_\Omega p = 0 \end{equation}" src="form_778.png"/>
</p>
 <dl class="section note"><dt>Note</dt><dd>This is also true for the incompressible Navier-Stokes equations. We chose <a class="el" href="classFeel_1_1Stokes.html" title="solves the stokes equations">Stokes</a> to simplify the exposure.</dd></dl>
<h2><a class="anchor" id="Numerical_Reformulation"></a>
Reformulation</h2>
<p>In order to impose the previous condition, we introduce a new unknown, a Lagrange multiplier, <img class="formulaInl" alt="$\lambda \in \mathbb{R} $" src="form_779.png"/> and modify the incompressibility equation. Our problem reads now, find <img class="formulaInl" alt="$(\mathbf{u},p,\lambda)$" src="form_780.png"/> such that </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \mbox{Stokes 2: }\left\{ \begin{array}{rcl} -\mu\Delta\mathbf{u} + \nabla p &amp;=&amp; \mathbf{f}\\ \nabla\cdot\mathbf{u} + \lambda &amp;=&amp; 0\\ \mathbf{u}|_{\partial \Omega} &amp;=&amp; 0\\ \int_\Omega p &amp;=&amp; 0 \end{array} \right. \end{equation*}" src="form_781.png"/>
</p>
 <dl class="section note"><dt>Note</dt><dd>The pressure field <img class="formulaInl" alt="$p$" src="form_282.png"/> can actually be seen as a Lagrange multiplier for the velocity <img class="formulaInl" alt="$\mathbf{u}$" src="form_748.png"/> in order to enforce the constraint <img class="formulaInl" alt="$\nabla \cdot \mathbf{u} = 0$" src="form_782.png"/>. <img class="formulaInl" alt="$\lambda$" src="form_286.png"/> will play the same role but for the pressure to enforce the condition. As <img class="formulaInl" alt="$h \rightarrow 0$" src="form_783.png"/>, <img class="formulaInl" alt="$\lambda \rightarrow 0$" src="form_784.png"/> as well as the divergence of <img class="formulaInl" alt="$\mathbf{u}$" src="form_748.png"/>. Note also that <img class="formulaInl" alt="$\int_\Omega \nabla \cdot \mathbf{u} \approx - \int_\Omega \lambda$" src="form_785.png"/> from the second equation.</dd></dl>
<h2><a class="anchor" id="Numerical_Variational"></a>
Variational formulation</h2>
<p>The variational formulation now reads: find <img class="formulaInl" alt="$(\mathbf{u}, p, \lambda) \in \mathbf{H}^1_0(\Omega) \times L^2_0(\Omega) \times \mathbb{R}$" src="form_786.png"/> such that for all <img class="formulaInl" alt="$(\mathbf{v}, q, \eta) \in \mathbf{H}^1_0(\Omega) \times L^2_0(\Omega) \times \mathbb{R}$" src="form_787.png"/> </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:20} \mbox{Stokes 3: }\left\{ \begin{array}{rcl} \int_\Omega \Big(\nabla \mathbf{u} \colon \nabla \mathbf{v} + \nabla \cdot \mathbf{v} p\Big) &amp;=&amp; \int_\Omega \mathbf{f} \cdot \mathbf{v}\\ \int_\Omega \Big(\nabla\cdot\mathbf{u} q + \lambda q\Big) &amp;=&amp; 0\\ \int_\Omega p \eta &amp;=&amp; 0 \end{array} \right. \end{equation*}" src="form_788.png"/>
</p>
<p>Summing up all three equations we get the following condensed formulation:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:19} \int_\Omega \nabla \mathbf{u} \colon \nabla \mathbf{v} + \nabla \cdot \mathbf{v} p + \nabla \cdot \mathbf{u} q + \lambda q + \eta p = \int_\Omega \mathbf{f} \cdot \mathbf{v} \end{equation*}" src="form_789.png"/>
</p>
<p> where <img class="formulaInl" alt="$\mathbf{H}^1_0(\Omega)= \Big\{ \mathbf{v} \in \mathbf{L}^2(\Omega), \nabla \mathbf{v} \in [L^2(\Omega)]^{d\times d},\ \mathbf{v} = 0\ \text{on}\ \partial \Omega \Big\}$" src="form_790.png"/>, <img class="formulaInl" alt="$L^2_0(\Omega)= \Big\{ v \in L^2(\Omega),\ \int_\Omega v = 0\Big\}$" src="form_791.png"/>, and <img class="formulaInl" alt="$\mathbf{L}^2(\Omega)= \Big\{ \mathbf{v} \in [L^2(\Omega)]^d\Big\}$" src="form_792.png"/> that is to say each component of a vector field of <img class="formulaInl" alt="$\mathbf{L}^2(\Omega)$" src="form_793.png"/> are in <img class="formulaInl" alt="$L^2(\Omega)$" src="form_794.png"/>.</p>
<h2><a class="anchor" id="Numercial_Implementation"></a>
Implementation</h2>
<div class="fragment"><div class="line"><span class="comment">//basis</span></div>
<div class="line"><span class="keyword">typedef</span> Lagrange&lt;Order, Vectorial&gt; basis_u_type; <span class="comment">// velocity</span></div>
<div class="line"><span class="keyword">typedef</span> Lagrange&lt;Order-1, Scalar&gt; basis_p_type; <span class="comment">// pressure</span></div>
<div class="line"><span class="keyword">typedef</span> Lagrange&lt;0, Scalar&gt; basis_l_type; <span class="comment">// multipliers</span></div>
<div class="line"><span class="keyword">typedef</span> bases&lt;basis_u_type, basis_p_type, basis_l_type&gt; basis_type;</div>
<div class="line"><span class="keyword">typedef</span> FunctionSpace&lt;mesh_type, basis_type, value_type&gt; space_type;</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line">space_ptrtype Xh = space_type::New( mesh );</div>
<div class="line">element_type U( Xh, <span class="stringliteral">&quot;u&quot;</span> );</div>
<div class="line">element_type V( Xh, <span class="stringliteral">&quot;v&quot;</span> );</div>
<div class="line">element_0_type u = U.element&lt;0&gt;();</div>
<div class="line">element_0_type v = V.element&lt;0&gt;();</div>
<div class="line">element_1_type p = U.element&lt;1&gt;();</div>
<div class="line">element_1_type q = V.element&lt;1&gt;();</div>
<div class="line">element_2_type lambda = U.element&lt;2&gt;();</div>
<div class="line">element_2_type nu = V.element&lt;2&gt;();</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line">sparse_matrix_ptrtype D( M_backend-&gt;newMatrix( Xh, Xh ) );</div>
<div class="line">form2( Xh, Xh, D, _init=<span class="keyword">true</span> )=</div>
<div class="line">   <a class="code" href="namespaceFeel.html#a4c300b4c137594540a9428af36363049" title="integrate a polynomial over a convex">integrate</a>( <a class="code" href="namespaceFeel.html#a39073cc1999197bf9963bd5bdc86454a">elements</a>(mesh), im,</div>
<div class="line">             <span class="comment">// $\nabla \mathbf{u} \colon \nabla \mathbf{v}$</span></div>
<div class="line">              mu*trace(deft*trans(def))</div>
<div class="line">              <span class="comment">// $\nabla \cdot \mathbf{v} p + \nabla \cdot \mathbf{u} q$</span></div>
<div class="line">              - div(v)*idt(p) + divt(u)*<span class="keywordtype">id</span>(q)</div>
<div class="line">              <span class="comment">// $\lambda q + \eta p$</span></div>
<div class="line">              +<span class="keywordtype">id</span>(q)*idt(lambda) + idt(p)*<span class="keywordtype">id</span>(nu) );</div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><h2><a class="anchor" id="Numerical_Fic"></a>
Fix point iteration for Navier-Stokes</h2>
<h3><a class="anchor" id="Fix_Steady"></a>
Steady incompressible Navier-Stokes equations</h3>
<p>Consider the following steady incompressible Navier-Stokes equations, find <img class="formulaInl" alt="$(\mathbf{u},p)$" src="form_776.png"/> such that </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{notes:eq:7} \begin{split} \underbrace{\rho \mathbf{u} \cdot \nabla \mathbf{u}}_{\text{convection}} - \underbrace{\nu \Delta \mathbf{u}}_{\text{diffusion}} + \nabla p &amp;= \mathbf{f} \ \text{on}\ \Omega \\ \nabla \cdot \mathbf{u} &amp;= 0 \\ \mathbf{u} &amp;= \mathbf{0}\ \text{on}\ \partial \Omega \end{split} \end{equation}" src="form_795.png"/>
</p>
<p> where <img class="formulaInl" alt="$\rho$" src="form_309.png"/> is the density of the fluid, <img class="formulaInl" alt="$\nu$" src="form_796.png"/> is the dynamic viscosity of the fluid(la viscosité cinématique <img class="formulaInl" alt="$\eta = \nu/\rho$" src="form_797.png"/>) and <img class="formulaInl" alt="$\mathbf{f}$" src="form_798.png"/> is the external force density applied to the fluid, (e.g. <img class="formulaInl" alt="$\mathbf{f}=-\rho g \mathbf{e}_2$" src="form_799.png"/> with <img class="formulaInl" alt="$\mathbf{e}_2=(0,1)^T$" src="form_800.png"/> ). This equation system is nonlinear due to the <img class="formulaInl" alt="$\mathbf{u} \cdot \nabla \mathbf{u}$" src="form_801.png"/> convection term. A simple approach to solve <img class="formulaInl" alt="$(2)$" src="form_265.png"/> is to use a fix point algorithm.</p>
<p>The fixpoint algorithm for NS reads as follows, find <img class="formulaInl" alt="$(\mathbf{u}^{(k)},p^{(k)})$" src="form_802.png"/> such that </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:13} \begin{split} \rho\mathbf{u}^{(k-1)} \cdot \nabla \mathbf{u}^{(k)} - \nu \Delta \mathbf{u}^{(k)} + \nabla p^{(k)} &amp;= \mathbf{f} \ \text{on}\ \Omega \\ \nabla \cdot \mathbf{u}^{(k)} &amp;= 0 \\ \mathbf{u}^{(k)} &amp;= 0\ \text{on}\ \partial \Omega\\ (\mathbf{u}^{(0)},p^{(0)}) &amp;= (\mathbf{0},0) \end{split} \end{equation*}" src="form_803.png"/>
</p>
<p> This system is now linear at each iteration <img class="formulaInl" alt="$k$" src="form_719.png"/> and we can write the variational formulation accordingly. A stopping criterium is for example that <img class="formulaInl" alt="$\|\mathbf{u}^{k}-\mathbf{u}^{(k-1)}\|+\|p^{k}-p^{(k-1)}\| < \epsilon$" src="form_804.png"/> where <img class="formulaInl" alt="$\epsilon$" src="form_12.png"/> is a given tolerance (e.g. <img class="formulaInl" alt="$1e-4$" src="form_805.png"/>) and <img class="formulaInl" alt="$\|\cdot\|$" src="form_806.png"/> is the <img class="formulaInl" alt="$L_2$" src="form_223.png"/> norm.</p>
<p>Here is the implementation using :</p>
<div class="fragment"><div class="line"><span class="comment">// define some tolerance $\epsilon$</span></div>
<div class="line">epsilon = 1e-4;</div>
<div class="line"><span class="comment">// set $(\mathbf{u}^{(0)},p^{(0)})$ to $(\mathbf{0},0)$</span></div>
<div class="line">velocity_element_type uk(Xh);</div>
<div class="line">velocity_element_type uk1(Xh);</div>
<div class="line">pressure_element_type pk(Ph);</div>
<div class="line">pressure_element_type pk1(Ph);</div>
<div class="line"><span class="comment">// by default uk1, uk and pk,pk1 are initialized to 0</span></div>
<div class="line">                                            </div>
<div class="line"><span class="comment">// assemble the linear form associated to $\mathbf{f}$</span></div>
<div class="line"><span class="comment">// store in vector $F$, it does not change over the iterations</span></div>
<div class="line">                                           </div>
<div class="line"><span class="comment">// iterations to find $(\mathbf{u}^{(k)},p^{(k)})$</span></div>
<div class="line"><span class="keywordflow">do</span></div>
<div class="line">{</div>
<div class="line">  <span class="comment">// save results of previous iterations</span></div>
<div class="line">  uk1 = uk;</div>
<div class="line">  pk1 = pk;</div>
<div class="line">                                           </div>
<div class="line">  <span class="comment">//assemble for bilinear form  associated to</span></div>
<div class="line">  <span class="comment">// $\rho\mathbf{u}^{(k-1)} \cdot \nabla \mathbf{u}^{(k)} - \nu \Delta  \mathbf{u}^{(k)} + \nabla p^{(k)}$</span></div>
<div class="line">  <span class="comment">// store in matrix $A^{(k)}$</span></div>
<div class="line">                                           </div>
<div class="line">  <span class="comment">// solve the system $A^{(k)} X = F$ where $X = (\mathbf{u}^{(k)},p^{(k)})^T$</span></div>
<div class="line">                                           </div>
<div class="line">  <span class="comment">// use uk,uk1 and pk,pk1 to compute the error estimation at each iteration</span></div>
<div class="line">  error = $\|\mathbf{u}^{k}-\mathbf{u}^{(k-1)}\|+\|p^{k}-p^{(k-1)}\|$</div>
<div class="line">} <span class="keywordflow">while</span>( error &gt; epsilon );</div>
</div><!-- fragment --><h2><a class="anchor" id="Nuerical_Coupling"></a>
A Fix point coupling algorithm</h2>
<h3><a class="anchor" id="Coupling_Problem"></a>
Coupling fluid flow and heat transfer: problem</h3>
<p>Recall that we have to solve two coupled problems : </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mbox{Heat(\textbf{u}) }\left\{ \begin{array}{rcc} - \kappa\Delta T + \mathbf{u}\cdot\nabla T &amp;=&amp; 0 \\ T|_{\Gamma_1} &amp;=&amp; T_0 \\ \frac{\partial T}{\partial \mathbf{n}}|_{\Gamma_3} &amp;=&amp;1 \\ \frac{\partial T}{\partial \mathbf{n}}|_{\Gamma_2,\Gamma_4} &amp;=&amp; 0 \end{array} \right. \]" src="form_807.png"/>
</p>
<p>and </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \mbox{Stokes(T) : }\left\{ \begin{array}{rcc} -\nu\Delta\mathbf{u} + \frac{1}{\rho}\nabla p = \mathbf{F}\\ \nabla\cdot\mathbf{u} = 0\\ \mathbf{u}|_{\partial \Omega} = 0 \end{array} \right. \]" src="form_808.png"/>
</p>
<p>Where <img class="formulaInl" alt="$\mathbf{F}$" src="form_809.png"/> can be taken as <img class="formulaInl" alt="$ \left( \begin{array}{c} 0 \\ \beta(T-T_0) \end{array} \right) $" src="form_810.png"/> for some <img class="formulaInl" alt="$\beta > 0$" src="form_811.png"/>. <img class="formulaInl" alt="$\beta$" src="form_812.png"/> is called the <em>dilatation</em> <em>coefficient</em>.</p>
<h3><a class="anchor" id="Coupling_Algorithm"></a>
Coupling fluid flow and heat transfer: algorithm</h3>
<p>Here is a simple algorithm fix point strategy in pseudo-code: </p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> tol = 1.e-6;</div>
<div class="line"><span class="keywordtype">int</span> maxIter = 50;</div>
<div class="line"><span class="comment">//Initial guess Un = 0</span></div>
<div class="line"><span class="keywordflow">do</span></div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Find Tn solution of Heat(Un)</span></div>
<div class="line">  <span class="comment">// Find Unp1 solution of Stokes(Tn)</span></div>
<div class="line">  <span class="comment">// compute stopTest = norme(Unp1 - Un)</span></div>
<div class="line">  <span class="comment">// Un = Unp1</span></div>
<div class="line">}<span class="keywordflow">while</span>((stopTest &lt; tol) &amp;&amp; (niter &lt;= maxIter));</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>To solve the unsteady problems, one can insert the previous loop in the one dedicated to time discretization</dd></dl>
<h2><a class="anchor" id="Numerical_Newton"></a>
A Newton coupling algorithm</h2>
<h3><a class="anchor" id="Newton_Scheme"></a>
A fully coupled scheme</h3>
<p>Another possiblity is to use a Newton method which allows us to solve the full nonlinear problem coupling velocity, pressure and temperature </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:21} \text{Find}\ X\ \text{such that}\ F(X) = 0 \end{equation*}" src="form_813.png"/>
</p>
<p> the method is iterative and reads, find <img class="formulaInl" alt="$X^{(n+1)}$" src="form_814.png"/> such that </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation} \label{notes:eq:22} J_F(X^{(n)})( X^{(n+1)}-X^{(n)}) = - F (X^{(n)}) \end{equation}" src="form_815.png"/>
</p>
<p> starting with <img class="formulaInl" alt="$X^{(0)} = \mathbf{0}$" src="form_816.png"/> or some other initial value and where <img class="formulaInl" alt="$J_F$" src="form_817.png"/> is the jacobian matrix of <img class="formulaInl" alt="$F$" src="form_555.png"/> evaluated at <img class="formulaInl" alt="$X=((u_i)_i,(p_i)_i,(\theta_i)_i)^T$" src="form_818.png"/>. For any <img class="formulaInl" alt="$\phi_k, \psi_l$" src="form_819.png"/> and <img class="formulaInl" alt="$\rho_m$" src="form_820.png"/> the <em>test</em> functions associated respectively to velocity, pressure and temperature, our full system reads, Find <img class="formulaInl" alt="$X=((u_i)_i,(p_i)_i,(\theta_i)_i)^T$" src="form_818.png"/> such that </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:23} \begin{array}{rll} F_1((u_i)_i,(p_i)_i,(\theta_i)_i)&amp;=\sum_{i,j} u_i u_j a(\phi_i,\phi_k,\phi_j) - \sum_i p_i b(\phi_k,\psi_i) + \sum_i \theta_i c(\rho_i, \phi_k)+\sum_i u_i d(\phi_i,\phi_k) &amp;= 0\\ F_2((u_i)_i,(p_i)_i,(\theta_i)_i)&amp;=\sum_i u_i b(\phi_i,\psi_l) &amp;=0\\ F_3((u_i)_i,(p_i)_i,(\theta_i)_i)&amp;=\sum_{i,j} u_i\theta_j e(\phi_i,\rho_j,\rho_m) + \sum_i \theta_i f(\rho_i,\rho_m)-g(\rho_m) &amp;= 0 \end{array} \end{equation*}" src="form_821.png"/>
</p>
<p> where <img class="formulaInl" alt="$F=(F_1,F_2,F_3)^T$" src="form_822.png"/> and </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:26} \begin{array}{rl} a(\mathbf{u},\mathbf{v},\beta) &amp;= \int_\Omega \mathbf{v}^T ((\nabla \mathbf{u} )\beta)\\ b(\mathbf{v},p) &amp;= \int_\Omega p (\nabla \cdot \mathbf{v}) - \int_{\partial \Omega} \mathbf{v}\cdot\mathbf{n} p\\ c(\theta,\mathbf{v})&amp;= \int_\Omega \theta \mathbf{e}_2 \cdot \mathbf{v}\\ d(\mathbf{u},\mathbf{v}) &amp;= \frac{1}{\sqrt{\mathrm{Gr}}} \Big(\int_\Omega \nabla \mathbf{u} \colon (\nabla \mathbf{v})^T - \int_{\partial \Omega} ((\nabla \mathbf{u}) \mathbf{n})\cdot \mathbf{v}\Big)\\ e(\mathbf{u},\theta,\chi) &amp;= \int_\Omega (\mathbf{u}\cdot \nabla \theta) \chi \\ f(\theta,\chi) &amp;=\frac{1}{\sqrt{\mathrm{Gr}}\mathrm{Pr}} \Big( \int_\Omega \nabla \theta \cdot \nabla \chi - \int_{\Gamma_1} (\nabla \theta \cdot \mathbf{n} ) \chi \Big)\\ g(\chi) &amp;=\frac{1}{\sqrt{\mathrm{Gr}}\mathrm{Pr}} \int_{\Gamma_3} \chi \end{array} \end{equation*}" src="form_823.png"/>
</p>
 <dl class="section note"><dt>Note</dt><dd>Note that the boundary integrals are kept in order to apply the weak Dirichlet boundary condition trick, see next section.</dd></dl>
<h3><a class="anchor" id="Newton_Jacobian"></a>
Jacobian matrix</h3>
<p>In order to apply the newton scheme, we need to compute the jacobian matrix <img class="formulaInl" alt="$J_F$" src="form_817.png"/> by deriving each equation with respect to each unknowns, ie <img class="formulaInl" alt="$u_i, p_i$" src="form_824.png"/> and <img class="formulaInl" alt="$\theta_i$" src="form_825.png"/>. Consider the first equation </p>
<ul>
<li>Deriving the first equation with respect to <img class="formulaInl" alt="$u_i$" src="form_826.png"/> we get <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:30} \frac{\partial F_1}{\partial u_i} = \sum_j u_j a(\phi_i,\phi_k,\phi_j) + \sum_i u_i a(\phi_i,\phi_k,\phi_j) + d(\phi_i,\phi_k) \end{equation*}" src="form_827.png"/>
</p>
 </li>
<li>Deriving the first equation with respect to <img class="formulaInl" alt="$p_i$" src="form_828.png"/> we get <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:30} \frac{\partial F_1}{\partial p_i} = -b(\phi_k,\psi_l) \end{equation*}" src="form_829.png"/>
</p>
 </li>
<li>Deriving the first equation with respect to <img class="formulaInl" alt="$\theta_i$" src="form_825.png"/> we get <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:30} \frac{\partial F_1}{\partial \theta_i} = c(\rho_i,\rho_k) \end{equation*}" src="form_830.png"/>
</p>
</li>
</ul>
<p>Consider the second equation, only the derivative with respect to <img class="formulaInl" alt="$u_i$" src="form_826.png"/> is non zero. </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:31} \frac{\partial F_2}{\partial u_i} = b(\phi_i,\psi_l) \end{equation*}" src="form_831.png"/>
</p>
<p> Finally the third component </p>
<ul>
<li>Deriving with respect to <img class="formulaInl" alt="$u_i$" src="form_826.png"/> <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:33} \frac{\partial F_3}{\partial u_i} = \sum_j \theta_j e(\phi_i,\rho_j,\rho_m) \end{equation*}" src="form_832.png"/>
</p>
 </li>
<li>Deriving with respect to <img class="formulaInl" alt="$p_i$" src="form_828.png"/>, <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:34} \frac{\partial F_3}{\partial p_i} = 0 \end{equation*}" src="form_833.png"/>
</p>
 </li>
<li>Deriving with respect to <img class="formulaInl" alt="$theta_i$" src="form_834.png"/>, <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:35} \frac{\partial F_3}{\partial \theta_i} = \sum_j u_j e(\phi_j,\rho_i,\rho_m) + f(\rho_i,\rho_m) \end{equation*}" src="form_835.png"/>
</p>
 <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:35} J_F = \begin{pmatrix} \frac{\partial F_1}{\partial u_i} &amp; \frac{\partial F_1}{\partial p_i} &amp; \frac{\partial F_1}{\partial \theta_i} \\ {\frac{\partial F_2}{\partial u_i}} &amp; {\frac{\partial F_2}{\partial p_i}}(=0) &amp; {\frac{\partial F_2}{\partial \theta_i}}(=0) \\ \frac{\partial F_3}{\partial u_i} &amp; {\frac{\partial F_3}{\partial p_i}}(=0) &amp; \frac{\partial F_3}{\partial \theta_i} \end{pmatrix} \end{equation*}" src="form_836.png"/>
</p>
 In order to implement <img class="formulaInl" alt="$J_F$" src="form_817.png"/> and solve <img class="formulaInl" alt="$(3)$" src="form_269.png"/>, <img class="formulaInl" alt="$J_F$" src="form_817.png"/> can be expressed as the matrix associated with the discretisation of <p class="formulaDsp">
<img class="formulaDsp" alt="\begin{equation*} \label{notes:eq:37} \begin{array}{rl} a(\mathbf{u},\mathbf{v},\beta_1) + a(\beta_1, \mathbf{v}, \mathbf{u})+d(\mathbf{u},\mathbf{v})-b(\mathbf{v},p)+c(\theta,\mathbf{v}) &amp;= 0\\ b(\mathbf{u},q)&amp;=0\\ e(\beta_1,\theta,\chi)+f(\theta,\chi)+e(\mathbf{u},\beta_2,\chi)&amp;=0\\ \end{array} \end{equation*}" src="form_837.png"/>
</p>
 where <img class="formulaInl" alt="$\beta_1 = u^{(n)}$" src="form_838.png"/>, <img class="formulaInl" alt="$\beta_2=\theta^{(n)}$" src="form_839.png"/> are known from the previous Newton iteration, indeed <img class="formulaInl" alt="$J_F$" src="form_817.png"/> is actually evaluated in <img class="formulaInl" alt="$X^{(n)}$" src="form_840.png"/>.</li>
</ul>
<h3><a class="anchor" id="Newton_Implementation"></a>
Implementation</h3>
<p>Now we use the <a href="http://www.feelpp.org">Feel++</a> non linear framework in order to implement our Newton scheme. We need to define two new functions in our application </p>
<ul>
<li><code>updateJacobian(X,J)</code> which takes as input <code>X</code> <img class="formulaInl" alt="$=X^{(n)}$" src="form_841.png"/> and returns the matrix <code>J=</code> <img class="formulaInl" alt="$J_F(X^{(n)})$" src="form_842.png"/> </li>
<li><code>updateResidual(X,R)</code> which takes as input <code>X</code> <img class="formulaInl" alt="$=X^{(n)}$" src="form_841.png"/> and returns the vector <code>R=</code> <img class="formulaInl" alt="$F(X^{(n)})$" src="form_843.png"/></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Only the PETSC backend supports the nonlinear solver framework. Use in the command line like in the first section <div class="fragment"><div class="line">--backend=petsc</div>
</div><!-- fragment --></dd></dl>
<p>Here is a snippet of code that implements the nonlinear framework. </p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyApp</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">  <span class="keywordtype">void</span> run();</div>
<div class="line">  <span class="keywordtype">void</span> updateResidual( <span class="keyword">const</span> vector_ptrtype&amp; X, vector_ptrtype&amp; R );</div>
<div class="line">  <span class="keywordtype">void</span> updateJacobian( <span class="keyword">const</span> vector_ptrtype&amp; X, sparse_matrix_ptrtype&amp; J);</div>
<div class="line">  <span class="keywordtype">void</span> solve( sparse_matrix_ptrtype&amp; D, element_type&amp; u, vector_ptrtype&amp; F );</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line">  backend_ptrtype M_backend;</div>
<div class="line">  sparse_matrix_ptrtype M_jac;</div>
<div class="line">  vector_ptrtype M_residual;</div>
<div class="line">};</div>
<div class="line">                                    </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">MyApp::run()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">                                    </div>
<div class="line">  <span class="comment">// plug the updateResidual and updateJacobian functions</span></div>
<div class="line">  <span class="comment">// in the nonlinear framework</span></div>
<div class="line">  M_backend-&gt;nlSolver()-&gt;residual = boost::bind( &amp;self_type::updateResidual,</div>
<div class="line">                                                 boost::ref( *<span class="keyword">this</span> ), _1, _2 );</div>
<div class="line">  M_backend-&gt;nlSolver()-&gt;jacobian = boost::bind( &amp;self_type::updateJacobian,</div>
<div class="line">                                                 boost::ref( *<span class="keyword">this</span> ), _1, _2 );</div>
<div class="line">                                    </div>
<div class="line">  vector_ptrtype U( M_backend-&gt;newVector( u.functionSpace() ) );</div>
<div class="line">  *U = u;</div>
<div class="line">  vector_ptrtype R( M_backend-&gt;newVector( u.functionSpace() ) );</div>
<div class="line">  this-&gt;updateResidual( U, R );</div>
<div class="line">  sparse_matrix_ptrtype J;</div>
<div class="line">  this-&gt;updateJacobian( U, J );</div>
<div class="line">  solve( J, u, R );</div>
<div class="line">                                    </div>
<div class="line">  *U = u;</div>
<div class="line">  this-&gt;updateResidual( U, R );</div>
<div class="line">  <span class="comment">// R(u) should be small</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;R( u ) = &quot;</span> &lt;&lt; M_backend-&gt;dot( U, R ) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">                                    </div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">MyApp::solve( sparse_matrix_ptrtype&amp; D, element_type&amp; u, vector_ptrtype&amp; F )</div>
<div class="line">{</div>
<div class="line">  vector_ptrtype U( M_backend-&gt;newVector( u.functionSpace() ) );</div>
<div class="line">  *U = u;</div>
<div class="line">  M_backend-&gt;nlSolve( D, U, F, 1e-10, 10 );</div>
<div class="line">  u = *U;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">MyApp::updateResidual( <span class="keyword">const</span> vector_ptrtype&amp; X, vector_ptrtype&amp; R )</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// compute R(X)</span></div>
<div class="line"></div>
<div class="line">  R=M_residual;</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">MyApp::updateJacobian( <span class="keyword">const</span> vector_ptrtype&amp; X, vector_ptrtype&amp; R )</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// compute J(X)</span></div>
<div class="line"></div>
<div class="line">  J=M_jac;</div>
<div class="line">}</div>
</div><!-- fragment --><p> see <code><a class="el" href="bratu_8cpp.html">bratu.cpp</a></code> or <code><a class="el" href="nonlinearpow_8cpp.html">nonlinearpow.cpp</a></code> for example. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<hr size="1"><address style="text-align: right;"><small>
Generated on Fri Jun 7 2013 00:07:41 for Feel++ by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.8.1.2</small></address>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-40726726-1', 'github.io');
  ga('send', 'pageview');
</script>
</body>
</html>
