<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.1.2"/>
<title>Feel++: Computing integrals</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="feel.css"   rel="stylesheet" type="text/css" />
<link href="feel.css" rel="stylesheet" type="text/css">
<!-- $extrastylesheet -->
<script type="text/javascript" src="eigen_navtree_hacks.js"></script>
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
    <div id="projectname"><a href="http://www.feelpp.org/"><img alt="Logo" src="feel_logo_small.png"/></a>
   &#160;<span id="projectnumber">0.92.1</span>
   </div>
   <div id="projectbrief">Finite Element Embedded Library and Language in C++</div>
  </td>
  <td width="500px" align="center" valign="bottom">
    <a href="http://www.feelpp.org/"><img alt="Feel++" src="home.png"/></a>
    <a href="https://github.com/feelpp/feelpp"><img alt="Feel++ on Github" src="http://sciactive.github.io/pnotify/includes/github-icon.png"/></a>
    <a href="https://plus.google.com/communities/104696212880173187475"><img alt="Feel++ community" src="google.png"/></a>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ComputingIntegrals.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Computing integrals </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><b>Previous:</b> <a class="el" href="ManipulatingMeshes.html">Manipulating Meshes</a> </li>
<li><b>Next:</b> <a class="el" href="ManipulatingFunctionSpaces.html">Manipulating Function Spaces</a></li>
</ul>
<h1><a class="anchor" id="ComputingIntegralsProblem"></a>
Problem Statement</h1>
<p>We would like to compute some integrals on a domain <img class="formulaInl" alt="$\Omega$" src="form_182.png"/> and parts of the domain, i.e. subregions and (parts of) boundary. In this tutorial the domain can be either</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Omega=[0,1]^d\ \subset\ \mathbb{R}^d \]" src="form_183.png"/>
</p>
<p>or</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \Omega=\{ \mathbf{x} \in \mathbb{R}^d | x_i \geq 0, \sum_{i=1}{d} x_i \leq 1 \} \]" src="form_184.png"/>
</p>
<p>with <img class="formulaInl" alt="$ d=1,2,3 $" src="form_185.png"/> and <img class="formulaInl" alt="$ \mathbf{x}=(x_1,...,x_d) $" src="form_186.png"/>.</p>
<p>These domains are plotted in this <a class="el" href="ManipulatingMeshes.html">Section</a>.</p>
<p>Once we have defined the computational mesh, we would like to compute the following integrals:</p>
<ul>
<li><img class="formulaInl" alt="$ \int_\Omega 1 $" src="form_187.png"/> : the measure of the domain</li>
<li><img class="formulaInl" alt="$ \int_{\partial\Omega} 1 $" src="form_188.png"/> the measure of the surface of the domain (Dim&gt;1)</li>
<li><img class="formulaInl" alt="$ \int_{\Omega} x^2+y^2+z^2 $" src="form_189.png"/> the integral over <img class="formulaInl" alt="$\Omega$" src="form_182.png"/> of <img class="formulaInl" alt="$ (x,y,z) \mapsto x^2+y^2+z^2$" src="form_190.png"/> with the convention that <img class="formulaInl" alt="$y=z=0$" src="form_191.png"/> in 1D and <img class="formulaInl" alt="$ z=0 $" src="form_192.png"/> in 3D.</li>
<li><img class="formulaInl" alt="$ \int_{\Omega} sin(x^2+y^2+z^2) $" src="form_193.png"/> the integral over <img class="formulaInl" alt="$\Omega$" src="form_182.png"/> of <img class="formulaInl" alt="$ (x,y,z) \mapsto sin(x^2+y^2+z^2)$" src="form_194.png"/> with the same convention as above.</li>
</ul>
<h1><a class="anchor" id="ComputingIntegralsCode"></a>
Implementation</h1>
<p>We now turn to the implementation. To compute the first integral, the code reads</p>
 <div class="fragment"></div><!-- fragment --></p>
<p><code>elements(mesh)</code> returns a pair of iterators over the elements owned by the current processor. Now that we have computed the integral of 1 over the region of <img class="formulaInl" alt="$\Omega$" src="form_182.png"/> current processor (ie the area of the domain owned by the processor), we want to compute the area of <img class="formulaInl" alt="$\Omega$" src="form_182.png"/>. To do that we collect the integrals on all processors using a <code>reduce</code> MPI operation and sum all contributions. We have used here the Boost.MPI library that provides an extremely powerful  wrapper around the MPI library. The code reads</p>
<p><div class="fragment"></div><!-- fragment --></p>
<p>Finally, we print to the log file the result of the local and global integral calculation.</p>
<p><div class="fragment"></div><!-- fragment --></p>
<p>Another calculation is for example to compute the perimeter of the domain</p>
<p><div class="fragment"></div><!-- fragment --></p>
<p>The main difference with the domain area computation resides in the elements with are iterating on: here we are iterating on the boundary faces of the domain to compute the integral using <code>boundaryfaces(mesh)</code> to provide the pairs of iterators.</p>
<p>Now say that we want to compute the third integral. The Finite Element Embedded Language (FEEL++) language provides the keyword <code>Px()</code> and <code>Py()</code> to denote the <img class="formulaInl" alt="$x$" src="form_195.png"/> and <img class="formulaInl" alt="$y$" src="form_196.png"/> coordinates like in equation above. The code reads then</p>
<p><div class="fragment"></div><!-- fragment --></p>
<h2><a class="anchor" id="ComputingIntegralsNote"></a>
A note on quadratures</h2>
<p><a class="el" href="namespaceFeel.html">Feel</a> computes automatically the quadrature associated the expression under the integral. If the expression is polynomial then the quadrature is exact. If the expression is not polynomial, then each non-polynomial term in the expression is considered a polynomial of degree 2 by default.</p>
<p>Here is how the 4-th integral can be computed letting <a class="el" href="namespaceFeel.html">Feel</a> decide about the quadrature</p>
<p><div class="fragment"></div><!-- fragment --></p>
<p>An alternative is to set yourself the quadrature by passing a new argument to the <code>integrate</code> function: <code>_Q&lt;Order&gt;()</code> where <code>Order</code> is the maximum polynomial order that the quadrature should integrate exactely.</p>
<p><div class="fragment"></div><!-- fragment --></p>
<h1><a class="anchor" id="ComputingIntegralsRuntime"></a>
Executing the code</h1>
<h2><a class="anchor" id="IntegralsOverSimplex"></a>
Integrals over a simplex domain</h2>
<p>Let's run now the tutrial example <code>feel_doc_myintegrals</code>: First we generate the simplex shape domain in all 3 dimensions</p>
<pre class="fragment">feel_doc_myintegrals --shape="simplex"--nochdir
</pre> <table><tr><td>  <div class="image">
<img src="myintegrals-simplex-1.png" alt="myintegrals-simplex-1.png"/>
<div class="caption">
Line</div></div>
  </td><td>  <div class="image">
<img src="myintegrals-simplex-2.png" alt="myintegrals-simplex-2.png"/>
<div class="caption">
Triangle</div></div>
  </td><td>  <div class="image">
<img src="myintegrals-simplex-3.png" alt="myintegrals-simplex-3.png"/>
<div class="caption">
Tetrahedron</div></div>
  </td></tr></table> <p>The output gives </p>
<div class="fragment"></div><!-- fragment --><h2><a class="anchor" id="IntegralsOverHypercube"></a>
Integrals over an hypercube domain</h2>
<p>We do the same now with the hypercube shape domain in all 3 dimensions</p>
<pre class="fragment">feel_doc_myintegrals --shape="hypercube"--nochdir
</pre> <table><tr><td>  <div class="image">
<img src="myintegrals-hypercube-1.png" alt="myintegrals-hypercube-1.png"/>
<div class="caption">
Line</div></div>
  </td><td>  <div class="image">
<img src="myintegrals-hypercube-2.png" alt="myintegrals-hypercube-2.png"/>
<div class="caption">
Unit Square</div></div>
  </td><td>  <div class="image">
<img src="myintegrals-hypercube-3.png" alt="myintegrals-hypercube-3.png"/>
<div class="caption">
Unit Cube</div></div>
  </td></tr></table> <p>The output gives </p>
<div class="fragment"></div><!-- fragment --><ul>
<li><b>Previous:</b> <a class="el" href="ManipulatingMeshes.html">Manipulating Meshes</a> </li>
<li><b>Next:</b> <a class="el" href="ManipulatingFunctionSpaces.html">Manipulating Function Spaces</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Apr 22 2013 16:29:05 for Feel++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
